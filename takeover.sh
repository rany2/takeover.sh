#!/bin/sh
# vim: set ts=4 sw=4:
#---help---
# Usage: takeover.sh [OPTIONS]
#
# This script will create an Alpine Linux rootfs in a tmpfs and pivot into it.
#
# Options:
#   -b, --branch BRANCH      The Alpine Linux branch to use. Default: latest-stable
#
#   -p, --packages PKGS      Additional packages to install. Default: btrfs-progs btrfs-progs-extra dosfstools e2fsprogs e2fsprogs-extra xfsprogs lsof umount tar gzip bzip2 xz htop nano
#
#   -t, --tmpfs-options OPTS Additional options for the tmpfs mount. Default: mode=0755
#
#   -P, --ssh-port PORT      The port to start the secondary sshd on. Default: 2222
#
#   -h, --help               Show this help message and exit.
#
#   -v, --version            Print version and exit.
#
# https://github.com/rany2/takeover.sh
#---help---

# Default user options.
ALPINE_BRANCH=latest-stable
PACKAGES="btrfs-progs btrfs-progs-extra dosfstools e2fsprogs e2fsprogs-extra xfsprogs"
PACKAGES="${PACKAGES} lsof umount tar gzip bzip2 xz"
PACKAGES="${PACKAGES} htop nano"
TMPFS_OPTIONS="mode=0755"
SSH_PORT=2222

# Exit on error and unset variable to catch issues early.
set -eu

readonly PROGNAME='takeover.sh'
readonly VERSION='0.0.4'

# Set pipefail if supported.
if ( set -o pipefail 2>/dev/null ); then
	set -o pipefail
fi

die() {
	printf '\033[1;31mERROR:\033[0m %s\n' "$@" >&2  # bold red
	exit 1
}

# Cleans the host system. This function is executed before exiting the script.
cleanup() {
	set +eu
	trap '' EXIT HUP INT TERM  # unset trap to avoid loop

	if [ -n "${TO}" ] && [ -d "${TO}" ]; then
		umount "${TO}" 2>/dev/null || true
		rmdir "${TO}"
	fi

	exit 1
}

# Prints help and exists with the specified status.
help() {
	sed -En '/^#---help---/,/^#---help---/p' "${0}" | sed -E 's/^# ?//; 1d;$d;'
	exit "${1:-0}"
}

# Check if all dependencies are available.
dep_check_strict() {
	for dep in $1; do
		if ! command -v "${dep}" > /dev/null 2>&1; then
			die "Dependency not found: ${dep}"
		fi
	done
}

# Check if any of the dependencies are available.
dep_check_any() {
	for dep in $1; do
		if command -v "${dep}" > /dev/null 2>&1; then
			return
		fi
	done
	die "None of the following dependencies found: $1"
}

# Check if all dependencies are available.
dep_check_strict "umount rmdir sed getopt mktemp tr head uname mount /bin/sh"  # takeover.sh
dep_check_strict "getopt grep sed sha256sum tar"  # stage1.sh
dep_check_strict "base64"
dep_check_any "wget curl"  # stage1.sh
dep_check_any "systemctl telinit"  # stage2.sh

# Parse command line options.
opts=$(getopt -n "${PROGNAME}" -o b:p:t:P:hv \
	-l branch:,packages:,tmpfs-options:,ssh-port:,help,version \
	-- "${@}") || help 1 >&2

eval set -- "${opts}"
while [ ${#} -gt 0 ]; do
	n=2
	case "${1}" in
		-b | --branch) ALPINE_BRANCH="${2}" ;;
		-p | --packages) PACKAGES="${2}" ;;
		-t | --tmpfs-options) TMPFS_OPTIONS="${2}" ;;
		-P | --ssh-port) SSH_PORT="${2}" ;;
		-h | --help) help 0 ;;
		-v | --version) echo "${PROGNAME} ${VERSION}"; exit 0 ;;
		--) shift; break ;;
	esac
	shift "${n}"
done

# Required packages for the Alpine Linux rootfs. These cannot be altered
# as later stages depend on them, especially busybox-static and dropbear.
# apk-tools isn't strictly required, but it's useful to the user in case
# they want to install additional packages later. alpine-release provides
# the APK repository keys so it is a required package for apk-tools,
# though it does not depend on it for some reason.
PACKAGES="${PACKAGES} alpine-release apk-tools openrc"
PACKAGES="${PACKAGES} busybox-static"
PACKAGES="${PACKAGES} dropbear"

# Check if the script is being run as root. This should be done before
# creating the temporary directory as it would otherwise likely fail
# due to permission/ownership issues.
[ "$(id -u)" -eq 0 ] || die 'This script must be run as root!'

# Create a temporary directory that will be used as the rootfs.
TO=$(mktemp -d /takeover.XXXXXX)
trap cleanup EXIT HUP INT TERM

# Generate a random password for the secondary SSH server.
SSH_PASSWORD=$(tr -d -c 'A-Za-z0-9' </dev/urandom | head -c 10 || true)
[ -n "${SSH_PASSWORD}" ] || die "Failed to generate a random password for the secondary SSH server!"

# This is done in case APK is not available on the host.
ARCH=$(uname -m)
case "${ARCH}" in
	x86_64)
		APK_TOOLS_URI="https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v2.14.4/x86_64/apk.static"
		APK_TOOLS_SHA256="42cea2a41dc09b263f04bb0ade8a2ba251256b91f89095ecc8a19903b2b3e39e"
		ALPINE_KEYS='
alpine-devel@lists.alpinelinux.org-4a6a0840.rsa.pub:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1yHJxQgsHQREclQu4Ohe\nqxTxd1tHcNnvnQTu/UrTky8wWvgXT+jpveroeWWnzmsYlDI93eLI2ORakxb3gA2O\nQ0Ry4ws8vhaxLQGC74uQR5+/yYrLuTKydFzuPaS1dK19qJPXB8GMdmFOijnXX4SA\njixuHLe1WW7kZVtjL7nufvpXkWBGjsfrvskdNA/5MfxAeBbqPgaq0QMEfxMAn6/R\nL5kNepi/Vr4S39Xvf2DzWkTLEK8pcnjNkt9/aafhWqFVW7m3HCAII6h/qlQNQKSo\nGuH34Q8GsFG30izUENV9avY7hSLq7nggsvknlNBZtFUcmGoQrtx3FmyYsIC8/R+B\nywIDAQAB
alpine-devel@lists.alpinelinux.org-5261cecb.rsa.pub:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwlzMkl7b5PBdfMzGdCT0\ncGloRr5xGgVmsdq5EtJvFkFAiN8Ac9MCFy/vAFmS8/7ZaGOXoCDWbYVLTLOO2qtX\nyHRl+7fJVh2N6qrDDFPmdgCi8NaE+3rITWXGrrQ1spJ0B6HIzTDNEjRKnD4xyg4j\ng01FMcJTU6E+V2JBY45CKN9dWr1JDM/nei/Pf0byBJlMp/mSSfjodykmz4Oe13xB\nCa1WTwgFykKYthoLGYrmo+LKIGpMoeEbY1kuUe04UiDe47l6Oggwnl+8XD1MeRWY\nsWgj8sF4dTcSfCMavK4zHRFFQbGp/YFJ/Ww6U9lA3Vq0wyEI6MCMQnoSMFwrbgZw\nwwIDAQAB
alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAutQkua2CAig4VFSJ7v54\nALyu/J1WB3oni7qwCZD3veURw7HxpNAj9hR+S5N/pNeZgubQvJWyaPuQDm7PTs1+\ntFGiYNfAsiibX6Rv0wci3M+z2XEVAeR9Vzg6v4qoofDyoTbovn2LztaNEjTkB+oK\ntlvpNhg1zhou0jDVYFniEXvzjckxswHVb8cT0OMTKHALyLPrPOJzVtM9C1ew2Nnc\n3848xLiApMu3NBk0JqfcS3Bo5Y2b1FRVBvdt+2gFoKZix1MnZdAEZ8xQzL/a0YS5\nHd0wj5+EEKHfOd3A75uPa/WQmA+o0cBFfrzm69QDcSJSwGpzWrD1ScH3AK8nWvoj\nv7e9gukK/9yl1b4fQQ00vttwJPSgm9EnfPHLAtgXkRloI27H6/PuLoNvSAMQwuCD\nhQRlyGLPBETKkHeodfLoULjhDi1K2gKJTMhtbnUcAA7nEphkMhPWkBpgFdrH+5z4\nLxy+3ek0cqcI7K68EtrffU8jtUj9LFTUC8dERaIBs7NgQ/LfDbDfGh9g6qVj1hZl\nk9aaIPTm/xsi8v3u+0qaq7KzIBc9s59JOoA8TlpOaYdVgSQhHHLBaahOuAigH+VI\nisbC9vmqsThF2QdDtQt37keuqoda2E6sL7PUvIyVXDRfwX7uMDjlzTxHTymvq2Ck\nhtBqojBnThmjJQFgZXocHG8CAwEAAQ==
-'
		;;
	riscv64)
		APK_TOOLS_URI="https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v2.14.4/riscv64/apk.static"
		APK_TOOLS_SHA256="312fc603c41d371f1808236574d48f3ef64f8ff0ddde40cc90f21c5f0326135d"
		ALPINE_KEYS='
alpine-devel@lists.alpinelinux.org-60ac2099.rsa.pub:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwR4uJVtJOnOFGchnMW5Y\nj5/waBdG1u5BTMlH+iQMcV5+VgWhmpZHJCBz3ocD+0IGk2I68S5TDOHec/GSC0lv\n6R9o6F7h429GmgPgVKQsc8mPTPtbjJMuLLs4xKc+viCplXc0Nc0ZoHmCH4da6fCV\ntdpHQjVe6F9zjdquZ4RjV6R6JTiN9v924dGMAkbW/xXmamtz51FzondKC52Gh8Mo\n/oA0/T0KsCMCi7tb4QNQUYrf+Xcha9uus4ww1kWNZyfXJB87a2kORLiWMfs2IBBJ\nTmZ2Fnk0JnHDb8Oknxd9PvJPT0mvyT8DA+KIAPqNvOjUXP4bnjEHJcoCP9S5HkGC\nIQIDAQAB
alpine-devel@lists.alpinelinux.org-616db30d.rsa.pub:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAnpUpyWDWjlUk3smlWeA0\nlIMW+oJ38t92CRLHH3IqRhyECBRW0d0aRGtq7TY8PmxjjvBZrxTNDpJT6KUk4LRm\na6A6IuAI7QnNK8SJqM0DLzlpygd7GJf8ZL9SoHSH+gFsYF67Cpooz/YDqWrlN7Vw\ntO00s0B+eXy+PCXYU7VSfuWFGK8TGEv6HfGMALLjhqMManyvfp8hz3ubN1rK3c8C\nUS/ilRh1qckdbtPvoDPhSbTDmfU1g/EfRSIEXBrIMLg9ka/XB9PvWRrekrppnQzP\nhP9YE3x/wbFc5QqQWiRCYyQl/rgIMOXvIxhkfe8H5n1Et4VAorkpEAXdsfN8KSVv\nLSMazVlLp9GYq5SUpqYX3KnxdWBgN7BJoZ4sltsTpHQ/34SXWfu3UmyUveWj7wp0\nx9hwsPirVI00EEea9AbP7NM2rAyu6ukcm4m6ATd2DZJIViq2es6m60AE6SMCmrQF\nwmk4H/kdQgeAELVfGOm2VyJ3z69fQuywz7xu27S6zTKi05Qlnohxol4wVb6OB7qG\nLPRtK9ObgzRo/OPumyXqlzAi/Yvyd1ZQk8labZps3e16bQp8+pVPiumWioMFJDWV\nGZjCmyMSU8V6MB6njbgLHoyg2LCukCAeSjbPGGGYhnKLm1AKSoJh3IpZuqcKCk5C\n8CM1S15HxV78s9dFntEqIokCAwEAAQ==
-'
		;;
	ppc64le)
		APK_TOOLS_URI="https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v2.14.4/ppc64le/apk.static"
		APK_TOOLS_SHA256="556f402287a43bd2a3c3b9b97ea76ba97d365794aa5be7ed448de3ba554e44e7"
		ALPINE_KEYS='
alpine-devel@lists.alpinelinux.org-58cbb476.rsa.pub:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoSPnuAGKtRIS5fEgYPXD\n8pSGvKAmIv3A08LBViDUe+YwhilSHbYXUEAcSH1KZvOo1WT1x2FNEPBEFEFU1Eyc\n+qGzbA03UFgBNvArurHQ5Z/GngGqE7IarSQFSoqewYRtFSfp+TL9CUNBvM0rT7vz\n2eMu3/wWG+CBmb92lkmyWwC1WSWFKO3x8w+Br2IFWvAZqHRt8oiG5QtYvcZL6jym\nY8T6sgdDlj+Y+wWaLHs9Fc+7vBuyK9C4O1ORdMPW15qVSl4Lc2Wu1QVwRiKnmA+c\nDsH/m7kDNRHM7TjWnuj+nrBOKAHzYquiu5iB3Qmx+0gwnrSVf27Arc3ozUmmJbLj\nzQIDAQAB
alpine-devel@lists.alpinelinux.org-616abc23.rsa.pub:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA0MfCDrhODRCIxR9Dep1s\neXafh5CE5BrF4WbCgCsevyPIdvTeyIaW4vmO3bbG4VzhogDZju+R3IQYFuhoXP5v\nY+zYJGnwrgz3r5wYAvPnLEs1+dtDKYOgJXQj+wLJBW1mzRDL8FoRXOe5iRmn1EFS\nwZ1DoUvyu7/J5r0itKicZp3QKED6YoilXed+1vnS4Sk0mzN4smuMR9eO1mMCqNp9\n9KTfRDHTbakIHwasECCXCp50uXdoW6ig/xUAFanpm9LtK6jctNDbXDhQmgvAaLXZ\nLvFqoaYJ/CvWkyYCgL6qxvMvVmPoRv7OPcyni4xR/WgWa0MSaEWjgPx3+yj9fiMA\n1S02pFWFDOr5OUF/O4YhFJvUCOtVsUPPfA/Lj6faL0h5QI9mQhy5Zb9TTaS9jB6p\nLw7u0dJlrjFedk8KTJdFCcaGYHP6kNPnOxMylcB/5WcztXZVQD5WpCicGNBxCGMm\nW64SgrV7M07gQfL/32QLsdqPUf0i8hoVD8wfQ3EpbQzv6Fk1Cn90bZqZafg8XWGY\nwddhkXk7egrr23Djv37V2okjzdqoyLBYBxMz63qQzFoAVv5VoY2NDTbXYUYytOvG\nGJ1afYDRVWrExCech1mX5ZVUB1br6WM+psFLJFoBFl6mDmiYt0vMYBddKISsvwLl\nIJQkzDwtXzT2cSjoj3T5QekCAwEAAQ==
-'
		;;
	aarch64)
		APK_TOOLS_URI="https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v2.14.4/aarch64/apk.static"
		APK_TOOLS_SHA256="0fbf66c343240dacd2ef5a31692542efcf107dbad35896caa4c3179a3bbed1e2"
		ALPINE_KEYS='
alpine-devel@lists.alpinelinux.org-58199dcc.rsa.pub:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3v8/ye/V/t5xf4JiXLXa\nhWFRozsnmn3hobON20GdmkrzKzO/eUqPOKTpg2GtvBhK30fu5oY5uN2ORiv2Y2ht\neLiZ9HVz3XP8Fm9frha60B7KNu66FO5P2o3i+E+DWTPqqPcCG6t4Znk2BypILcit\nwiPKTsgbBQR2qo/cO01eLLdt6oOzAaF94NH0656kvRewdo6HG4urbO46tCAizvCR\nCA7KGFMyad8WdKkTjxh8YLDLoOCtoZmXmQAiwfRe9pKXRH/XXGop8SYptLqyVVQ+\ntegOD9wRs2tOlgcLx4F/uMzHN7uoho6okBPiifRX+Pf38Vx+ozXh056tjmdZkCaV\naQIDAQAB
alpine-devel@lists.alpinelinux.org-616ae350.rsa.pub:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAyduVzi1mWm+lYo2Tqt/0\nXkCIWrDNP1QBMVPrE0/ZlU2bCGSoo2Z9FHQKz/mTyMRlhNqTfhJ5qU3U9XlyGOPJ\npiM+b91g26pnpXJ2Q2kOypSgOMOPA4cQ42PkHBEqhuzssfj9t7x47ppS94bboh46\nxLSDRff/NAbtwTpvhStV3URYkxFG++cKGGa5MPXBrxIp+iZf9GnuxVdST5PGiVGP\nODL/b69sPJQNbJHVquqUTOh5Ry8uuD2WZuXfKf7/C0jC/ie9m2+0CttNu9tMciGM\nEyKG1/Xhk5iIWO43m4SrrT2WkFlcZ1z2JSf9Pjm4C2+HovYpihwwdM/OdP8Xmsnr\nDzVB4YvQiW+IHBjStHVuyiZWc+JsgEPJzisNY0Wyc/kNyNtqVKpX6dRhMLanLmy+\nf53cCSI05KPQAcGj6tdL+D60uKDkt+FsDa0BTAobZ31OsFVid0vCXtsbplNhW1IF\nHwsGXBTVcfXg44RLyL8Lk/2dQxDHNHzAUslJXzPxaHBLmt++2COa2EI1iWlvtznk\nOk9WP8SOAIj+xdqoiHcC4j72BOVVgiITIJNHrbppZCq6qPR+fgXmXa+sDcGh30m6\n9Wpbr28kLMSHiENCWTdsFij+NQTd5S47H7XTROHnalYDuF1RpS+DpQidT5tUimaT\nJZDr++FjKrnnijbyNF8b98UCAwEAAQ==
-'
		;;
	*)
		die "Unsupported architecture: ${ARCH}"
		;;
esac

# Mount a tmpfs to use as the rootfs.
mount -t tmpfs -o "${TMPFS_OPTIONS}" none "${TO}" || die "Failed to mount tmpfs!"

# Add an environment variable to indicate that the script is being run from takeover.sh.
export __RUN_FROM_TAKEOVER_SH=1

# Export the variables for the stage scripts.
export ALPINE_BRANCH ALPINE_KEYS APK_TOOLS_SHA256 APK_TOOLS_URI PACKAGES # stage1.sh
export SSH_PASSWORD SSH_PORT TO # stage2.sh

# Execute the first stage script to create the Alpine Linux rootfs.
printf '%s' 'IyEvYmluL3NoCiMgdmltOiBzZXQgdHM9NCBzdz00OgojLS0taGVscC0tLQojIFVzYWdlOiBzdGFnZTEuc2ggW29wdGlvbnNdIFstLV0gPGRlc3Q+IFs8c2NyaXB0PiBbPHNjcmlwdC1vcHRzLi4uPl1dCiMKIyBUaGlzIHNjcmlwdCBjcmVhdGVzIEFscGluZSBMaW51eCByb290ZnMgZm9yIGNvbnRhaW5lcnMuIEl0IG11c3QgYmUgcnVuIGFzCiMgcm9vdCAtIHRvIGNyZWF0ZSBmaWxlcyB3aXRoIGNvcnJlY3QgcGVybWlzc2lvbnMgYW5kIHVzZSBjaHJvb3QgKG9wdGlvbmFsKS4KIyBJZiAkQVBLIGlzIG5vdCBhdmFpbGFibGUgb24gdGhlIGhvc3Qgc3lzdGVtLCB0aGVuIHN0YXRpYyBhcGstdG9vbHMKIyBzcGVjaWZpZWQgYnkgJEFQS19UT09MU19VUkkgaXMgZG93bmxvYWRlZCBhbmQgdXNlZC4KIwojIEFyZ3VtZW50czoKIyAgIDxkZXN0PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGF0aCB3aGVyZSB0byB3cml0ZSB0aGUgcm9vdGZzLgojCiMgICA8c2NyaXB0PiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhdGggb2Ygc2NyaXB0IHRvIGV4ZWN1dGUgYWZ0ZXIgaW5zdGFsbGluZyBiYXNlIHN5c3RlbSBpbgojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgcHJlcGFyZWQgcm9vdGZzIGFuZCBiZWZvcmUgY2xlYW4tdXAuIFVzZSAiLSIgdG8gcmVhZAojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgc2NyaXB0IGZyb20gU1RESU47IGlmIGl0IGRvZXNuJ3Qgc3RhcnQgd2l0aCBhIHNoZWJhbmcsCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIjIS9iaW4vc2ggLWUiIGlzIHByZXBlbmRlZC4KIwojICAgPHNjcmlwdC1vcHRzPiAgICAgICAgICAgICAgICAgICAgICAgICBBcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgc2NyaXB0LgojCiMgT3B0aW9ucyBhbmQgRW52aXJvbm1lbnQgVmFyaWFibGVzOgojICAgLWIgLS1icmFuY2ggQUxQSU5FX0JSQU5DSCAgICAgICAgICAgICBBbHBpbmUgYnJhbmNoIHRvIGluc3RhbGw7IHVzZWQgb25seSB3aGVuCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tcmVwb3NpdG9yaWVzLWZpbGUgaXMgbm90IHNwZWNpZmllZC4gRGVmYXVsdCBpcwojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRlc3Qtc3RhYmxlLgojCiMgICAgICAtLWtleXMtZGlyIEtFWVNfRElSICAgICAgICAgICAgICAgIFBhdGggb2YgZGlyZWN0b3J5IHdpdGggQWxwaW5lIGtleXMgdG8gY29weSBpbnRvCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSByb290ZnMuIERlZmF1bHQgaXMgL2V0Yy9hcGsva2V5cy4gSWYgZG9lcyBub3QgZXhpc3QsCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXMgc3BlY2lmaWVkIGluIEFMUElORV9LRVlTIGVudmlyb25tZW50IHZhcmlhYmxlIGFyZSB1c2VkLgojCiMgICAtbSAtLW1pcnJvci11cmkgQUxQSU5FX01JUlJPUiAgICAgICAgIFVSSSBvZiB0aGUgQXBvcnRzIG1pcnJvciB0byBmZXRjaCBwYWNrYWdlczsgdXNlZCBvbmx5CiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZW4gLS1yZXBvc2l0b3JpZXMtZmlsZSBpcyBub3Qgc3BlY2lmaWVkLiBEZWZhdWx0IGlzCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0dHA6Ly9kbC1jZG4uYWxwaW5lbGludXgub3JnL2FscGluZS4KIwojICAgLUMgLS1uby1jbGVhbnVwIChDTEVBTlVQKSAgICAgICAgICAgICBEb24ndCB1bW91bnQgYW5kIHJlbW92ZSB0ZW1wb3JhcnkgZGlyZWN0b3JpZXMgd2hlbiBkb25lLgojCiMgICAgICAtLW5vLWRlZmF1bHQtcGtncyAoREVGQVVMVF9QS0dTKSAgIERvbid0IGluc3RhbGwgdGhlIGRlZmF1bHQgYmFzZSBwYWNrYWdlcyAoYWxwaW5lLWJhc2VsYXlvdXQKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVzeWJveCBidXN5Ym94LXN1aWQgbXVzbC11dGlscyksIGkuZS4gb25seSB0aGUgcGFja2FnZXMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlY2lmaWVkIGluIC0tcGFja2FnZXMgd2lsbCBiZSBpbnN0YWxsZWQuIFVzZSBvbmx5IGlmCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlvdSBrbm93IHdoYXQgYXJlIHlvdSBkb2luZyEKIwojICAgLXAgLS1wYWNrYWdlcyBQQUNLQUdFUyAgICAgICAgICAgICAgICBBZGRpdGlvbmFsIHBhY2thZ2VzIHRvIGluc3RhbGwgaW50byB0aGUgcm9vdGZzLgojCiMgICAtciAtLXJlcG9zaXRvcmllcy1maWxlIFJFUE9TX0ZJTEUgICAgIFBhdGggb2YgcmVwb3NpdG9yaWVzIGZpbGUgdG8gY29weSBpbnRvIHRoZSByb290ZnMuCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmIG5vdCBzcGVjaWZpZWQsIGEgcmVwb3NpdG9yaWVzIGZpbGUgd2lsbCBiZSBjcmVhdGVkIHdpdGgKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxwaW5lJ3MgbWFpbiBhbmQgY29tbXVuaXR5IHJlcG9zaXRvcmllcyBvbiAtLW1pcnJvci11cmkuCiMKIyAgIC1jIC0tc2NyaXB0LWNocm9vdCAoU0NSSVBUX0NIUk9PVCkgICAgQmluZCA8c2NyaXB0PidzIGRpcmVjdG9yeSAob3IgQ1dEIGlmIHJlYWQgZnJvbSBTVERJTikgYXQKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL21udCBpbnNpZGUgdGhlIHJvb3RmcyBkaXIgYW5kIGNocm9vdCBpbnRvIHRoZSByb290ZnMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlIGV4ZWN1dGluZyA8c2NyaXB0Pi4gT3RoZXJ3aXNlIDxzY3JpcHQ+IGlzIGV4ZWN1dGVkCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSBjdXJyZW50IGRpcmVjdG9yeSBhbmQgJFJPT1RGUyB2YXJpYWJsZSBwb2ludHMgdG8KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlIHJvb3RmcyBkaXJlY3RvcnkuCiMKIyAgIC1kIC0tdGVtcC1kaXIgVEVNUF9ESVIgICAgICAgICAgICAgICAgUGF0aCB3aGVyZSB0byBjcmVhdGUgYSB0ZW1wb3JhcnkgZGlyZWN0b3J5OyB1c2VkIGZvcgojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZGluZyBhcGstdG9vbHMgd2hlbiBub3QgYXZhaWxhYmxlIG9uIHRoZSBob3N0CiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5dGVtIG9yIGZvciByb290ZnMgd2hlbiA8ZGVzdD4gaXMgIi0iIChpLmUuIFNURE9VVCkuCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoaXMgcGF0aCBtdXN0IG5vdCBleGlzdCEgRGVmYXVsdHMgdG8gdXNpbmcgYG1rZGlyIC1kYC4KIwojICAgLWggLS1oZWxwICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaG93IHRoaXMgaGVscCBtZXNzYWdlIGFuZCBleGl0LgojCiMgICAtdiAtLXZlcnNpb24gICAgICAgICAgICAgICAgICAgICAgICAgIFByaW50IHZlcnNpb24gYW5kIGV4aXQuCiMKIyAgIEFQSyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQVBLIGNvbW1hbmQgdG8gdXNlLiBEZWZhdWx0IGlzICJhcGsiLgojCiMgICBBUEtfT1BUUyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbnMgdG8gcGFzcyBpbnRvIGFwayBvbiBlYWNoIGV4ZWN1dGlvbi4KIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdCBpcyAiLS1uby1wcm9ncmVzcyIuCiMKIyAgIEFQS19UT09MU19VUkkgICAgICAgICAgICAgICAgICAgICAgICAgVVJMIG9mIGFway10b29scyBiaW5hcnkgdG8gZG93bmxvYWQgaWYgJEFQSyBpcyBub3QgZm91bmQKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb24gdGhlIGhvc3Qgc3lzdGVtLiBSZXF1aXJlZC4KIwojICAgQVBLX1RPT0xTX1NIQTI1NiAgICAgICAgICAgICAgICAgICAgICBTSEEtMjU2IGNoZWNrc3VtIG9mICRBUEtfVE9PTFNfVVJJLiBSZXF1aXJlZC4KIwojICAgQUxQSU5FX0tFWVMgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0IG9mIEFscGluZSBrZXlzIHRvIGVtYmVkIGluIHRoZSBzY3JpcHQuIEVhY2ggbGluZQojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXN0IGJlIGluIHRoZSBmb3JtYXQgImZpbGVuYW1lOmNvbnRlbnQiIHdpdGggY29udGVudAojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWluZyB0aGUga2V5IGluIEFTQ0lJLWFybW9yZWQgZm9ybWF0IHByaW50ZiBlbmNvZGVkLgojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXF1aXJlZC4KIwojIEVhY2ggb3B0aW9uIGNhbiBiZSBhbHNvIHByb3ZpZGVkIGJ5IGVudmlyb25tZW50IHZhcmlhYmxlLiBJZiBib3RoIG9wdGlvbiBhbmQKIyB2YXJpYWJsZSBpcyBzcGVjaWZpZWQgYW5kIHRoZSBvcHRpb24gYWNjZXB0cyBvbmx5IG9uZSBhcmd1bWVudCwgdGhlbiB0aGUKIyBvcHRpb24gdGFrZXMgcHJlY2VkZW5jZS4KIwojIE1vZGlmaWVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2FscGluZWxpbnV4L2FscGluZS1tYWtlLXJvb3Rmcy4KIy0tLWhlbHAtLS0Kc2V0IC1ldQoKcmVhZG9ubHkgUFJPR05BTUU9J3Rha2VvdmVyLnNoLXN0YWdlMScKcmVhZG9ubHkgVkVSU0lPTj0nMC43LjAtdGFrZW92ZXIuc2gwLjAuNCcKCiMgQmFzZSBBbHBpbmUgcGFja2FnZXMgdG8gaW5zdGFsbCBpbiByb290ZnMuCnJlYWRvbmx5IEFMUElORV9CQVNFX1BLR1M9J2FscGluZS1iYXNlbGF5b3V0IGJ1c3lib3ggYnVzeWJveC1zdWlkIG11c2wtdXRpbHMnCgojIEFuIG9wYXF1ZSBzdHJpbmcgdXNlZCB0byBkZXRlY3QgY2hhbmdlcyBpbiByZXNvbHYuY29uZi4KcmVhZG9ubHkgUkVTT0xWQ09ORl9NQVJLPSIjIyMgY3JlYXRlZCBieSAke1BST0dOQU1FfSAjIyMiCiMgTmFtZSB1c2VkIGFzIGEgInZpcnR1YWwgcGFja2FnZSIgZm9yIHRlbXBvcmFyaWx5IGluc3RhbGxlZCBwYWNrYWdlcy4KcmVhZG9ubHkgVklSVFVBTF9QS0c9Ii5tYWtlLSR7UFJPR05BTUV9IgoKIyBEZWZpbmUgYSBmdW5jdGlvbiB0byBwcmludCBhbiBlcnJvciBtZXNzYWdlIGFuZCBleGl0CmRpZSgpIHsKCXByaW50ZiAnXDAzM1sxOzMxbUVSUk9SOlwwMzNbMG0gJXNcbicgIiR7QH0iID4mMiAgIyBib2xkIHJlZAoJZXhpdCAxCn0KCiMgRW5zdXJlIHRoYXQgdGhpcyBzY3JpcHQgaXMgcnVuIGZyb20gdGFrZW92ZXIuc2gKWyAiJHtfX1JVTl9GUk9NX1RBS0VPVkVSX1NIOi19IiA9ICIxIiBdIHx8IFwKCWRpZSAiVGhpcyBzY3JpcHQgbXVzdCBub3QgYmUgZXhlY3V0ZWQgZGlyZWN0bHkhIFVzZSB0YWtlb3Zlci5zaC4iCgpBUEs9IiR7QVBLOi1hcGt9IgpBUEtfT1BUUz0iJHtBUEtfT1BUUzotLS1uby1wcm9ncmVzc30iCkFQS19UT09MU19VUkk9IiR7QVBLX1RPT0xTX1VSSTo/fSIKQVBLX1RPT0xTX1NIQTI1Nj0iJHtBUEtfVE9PTFNfU0hBMjU2Oj99IgpBTFBJTkVfS0VZUz0iJHtBTFBJTkVfS0VZUzo/fSIKCiMgU2V0IHBpcGVmYWlsIGlmIHN1cHBvcnRlZC4KaWYgKCBzZXQgLW8gcGlwZWZhaWwgMj4vZGV2L251bGwgKTsgdGhlbgoJc2V0IC1vIHBpcGVmYWlsCmZpCgojIEZvciBjb21wYXRpYmlsaXR5IHdpdGggc3lzdGVtcyB0aGF0IGRvZXMgbm90IGhhdmUgInJlYWxwYXRoIiBjb21tYW5kLgppZiAhIGNvbW1hbmQgLXYgcmVhbHBhdGggPi9kZXYvbnVsbDsgdGhlbgoJYWxpYXMgcmVhbHBhdGg9J3JlYWRsaW5rIC1mJwpmaQoKZWluZm8oKSB7CglwcmludGYgJ1xuXDAzM1sxOzM2bT4gJXNcMDMzWzBtXG4nICIke0B9IiA+JjIgICMgYm9sZCBjeWFuCn0KCiMgUHJpbnRzIGhlbHAgYW5kIGV4aXN0cyB3aXRoIHRoZSBzcGVjaWZpZWQgc3RhdHVzLgpoZWxwKCkgewoJc2VkIC1FbiAnL14jLS0taGVscC0tLS8sL14jLS0taGVscC0tLS9wJyAiJHswfSIgfCBzZWQgLUUgJ3MvXiMgPy8vOyAxZDskZDsnCglleGl0ICIkezE6LTB9Igp9CgojIENsZWFucyB0aGUgaG9zdCBzeXN0ZW0uIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgYmVmb3JlIGV4aXRpbmcgdGhlIHNjcmlwdC4KY2xlYW51cCgpIHsKCXNldCArZXUKCXRyYXAgJycgRVhJVCBIVVAgSU5UIFRFUk0gICMgdW5zZXQgdHJhcCB0byBhdm9pZCBsb29wCgoJaWYgWyAtZCAiJHtURU1QX0RJUn0iIF07IHRoZW4KCQlybSAtUmYgIiR7VEVNUF9ESVJ9IgoJZmkKCWlmIFsgLWQgIiR7cm9vdGZzfSIgXTsgdGhlbgoJCXVtb3VudF9yZWN1cnNpdmVseSAiJHtyb290ZnN9IiBcCgkJCXx8IGRpZSAiRmFpbGVkIHRvIHVubW91bnQgbW91bnRzIGluc2lkZSAke3Jvb3Rmc30hIgoJCVsgIiR7cm9vdGZzfSIgPSAiJHtST09URlNfREVTVH0iIF0gfHwgcm0gLVJmICIke3Jvb3Rmc30iCglmaQp9CgpfYXBrKCkgewoJIiR7QVBLfSIgJHtBUEtfT1BUU30gIiR7QH0iCn0KCiMgV3JpdGVzIEFscGluZSBBUEsga2V5cyBlbWJlZGRlZCBpbiB0aGlzIHNjcmlwdCBpbnRvIGRpcmVjdG9yeSAkMS4KZHVtcF9hbHBpbmVfa2V5cygpIHsKCWRlc3RfZGlyPSIkezF9IgoKCW1rZGlyIC1wICIke2Rlc3RfZGlyfSIKCWZvciBsaW5lIGluICR7QUxQSU5FX0tFWVN9OyBkbwoJCWZpbGU9JHtsaW5lJSU6Kn0KCQljb250ZW50PSR7bGluZSMqOn0KCgkJcHJpbnRmIC0tICItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuJHtjb250ZW50fVxuLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tXG4iIFwKCQkJPiAiJHtkZXN0X2Rpcn0vJHtmaWxlfSIKCWRvbmUKfQoKIyBCaW5kcyB0aGUgZGlyZWN0b3J5ICQxIGF0IHRoZSBtb3VudHBvaW50ICQyIGFuZCBzZXRzIHByb3BhZ2F0aW9uIHRvIHByaXZhdGUuCm1vdW50X2JpbmQoKSB7Cglta2RpciAtcCAiJHsyfSIKCW1vdW50IC0tYmluZCAiJHsxfSIgIiR7Mn0iCgltb3VudCAtLW1ha2UtcHJpdmF0ZSAiJHsyfSIKfQoKIyBQcmVwYXJlcyBjaHJvb3QgYXQgdGhlIHNwZWNpZmllZCBwYXRoLgpwcmVwYXJlX2Nocm9vdCgpIHsKCWRlc3Q9IiR7MX0iCgoJbWtkaXIgLXAgIiR7ZGVzdH0iL3Byb2MKCW1vdW50IC10IHByb2Mgbm9uZSAiJHtkZXN0fSIvcHJvYwoJbW91bnRfYmluZCAvZGV2ICIke2Rlc3R9Ii9kZXYKCW1vdW50X2JpbmQgL3N5cyAiJHtkZXN0fSIvc3lzCgoJaW5zdGFsbCAtRCAtbSA2NDQgL2V0Yy9yZXNvbHYuY29uZiAiJHtkZXN0fSIvZXRjL3Jlc29sdi5jb25mCgllY2hvICIke1JFU09MVkNPTkZfTUFSS30iID4+ICIke2Rlc3R9Ii9ldGMvcmVzb2x2LmNvbmYKfQoKIyBVbm1vdW50cyBhbGwgZmlsZXN5c3RlbXMgdW5kZXIgdGhlIGRpcmVjdG9yeSB0cmVlICQxIChtdXN0IGJlIGFic29sdXRlIHBhdGgpLgp1bW91bnRfcmVjdXJzaXZlbHkoKSB7Cgltb3VudF9wb2ludD0iJChyZWFscGF0aCAiJHsxfSIpIgoKCWN1dCAtZCAnICcgLWYgMiAvcHJvYy9tb3VudHMgXAoJCXwgeyBncmVwICJeJHttb3VudF9wb2ludH0vIiB8fCB0cnVlOyB9IFwKCQl8IHNvcnQgLXIgXAoJCXwgeGFyZ3MgLXIgLW4gMSB1bW91bnQKfQoKIyBEb3dubG9hZHMgdGhlIHNwZWNpZmllZCBmaWxlIHVzaW5nIHdnZXQgb3IgY3VybCBhbmQgY2hlY2tzIGNoZWNrc3VtLgp3Z2V0cygpICgKCXVybD0iJHsxfSIKCXNoYTI1Nj0iJHsyfSIKCWRlc3Q9IiR7MzotLn0iCgoJaWYgY29tbWFuZCAtdiB3Z2V0ID4vZGV2L251bGwgMj4mMTsgdGhlbgoJCWNkICIke2Rlc3R9IiBcCgkJCSYmIHdnZXQgLVQgMTAgLS1uby12ZXJib3NlICIke3VybH0iIFwKCQkJJiYgZWNobyAiJHtzaGEyNTZ9ICAke3VybCMjKi99IiB8IHNoYTI1NnN1bSAtYwoJZWxpZiBjb21tYW5kIC12IGN1cmwgPi9kZXYvbnVsbCAyPiYxOyB0aGVuCgkJY2QgIiR7ZGVzdH0iIFwKCQkJJiYgY3VybCAtLWNvbm5lY3QtdGltZW91dCAxMCAtTCAtZiAtc1MgLU8gIiR7dXJsfSIgXAoJCQkmJiBlY2hvICIke3NoYTI1Nn0gICR7dXJsIyMqL30iIHwgc2hhMjU2c3VtIC1jCgllbHNlCgkJZGllICdOZWl0aGVyIHdnZXQgbm9yIGN1cmwgZm91bmQhJwoJZmkKCikKCiMgV3JpdGVzIFNURElOIGludG8gZmlsZSAkMSBhbmQgc2V0cyBpdCBleGVjdXRhYmxlIGJpdC4gSWYgdGhlIGNvbnRlbnQgZG9lcyBub3QKIyBzdGFydCB3aXRoIGEgc2hlYmFuZywgcHJlcGVuZHMgIiMhL2Jpbi9zaCAtZSIgYmVmb3JlIHRoZSBmaXJzdCBsaW5lLgp3cml0ZV9zY3JpcHQoKSB7CglmaWxlbmFtZT0iJHsxfSIKCgljYXQgPiAiJHtmaWxlbmFtZX0udG1wIgoKCWlmICEgZ3JlcCAtcSAtbSAxICdeIyEnICIke2ZpbGVuYW1lfS50bXAiOyB0aGVuCgkJZWNobyAiIyEvYmluL3NoIC1lIiA+ICIke2ZpbGVuYW1lfSIKCWZpCgoJY2F0ICIke2ZpbGVuYW1lfS50bXAiID4+ICIke2ZpbGVuYW1lfSIKCXJtICIke2ZpbGVuYW1lfS50bXAiCgoJY2htb2QgK3ggIiR7ZmlsZW5hbWV9Igp9CgoKIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICBNIGEgaSBuICA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0jCgpvcHRzPSQoZ2V0b3B0IC1uICIke1BST0dOQU1FfSIgLW8gYjptOkNwOnI6czpjZDp0OmhWIFwKCS1sIGJyYW5jaDosZnMtc2tlbC1jaG93bjosZnMtc2tlbC1kaXI6LGtleXMtZGlyOixtaXJyb3ItdXJpOixuby1jbGVhbnVwLG5vLWRlZmF1bHQtcGtncyxwYWNrYWdlczoscmVwb3NpdG9yaWVzLWZpbGU6LHNjcmlwdC1jaHJvb3QsdGVtcC1kaXI6LGhlbHAsdmVyc2lvbiBcCgktLSAiJHtAfSIpIHx8IGhlbHAgMSA+JjIKCmV2YWwgc2V0IC0tICIke29wdHN9Igp3aGlsZSBbICR7I30gLWd0IDAgXTsgZG8KCW49MgoJY2FzZSAiJHsxfSIgaW4KCQktYiB8IC0tYnJhbmNoKSBBTFBJTkVfQlJBTkNIPSIkezJ9Ijs7CgkJICAgICAtLWtleXMtZGlyKSBLRVlTX0RJUj0iJHsyfSI7OwoJCS1tIHwgLS1taXJyb3ItdXJpKSBBTFBJTkVfTUlSUk9SPSIkezJ9Ijs7CgkJLUMgfCAtLW5vLWNsZWFudXApIENMRUFOVVA9J25vJzsgbj0xOzsKCQkgICAgIC0tbm8tZGVmYXVsdC1wa2dzKSBERUZBVUxUX1BLR1M9J25vJzsgbj0xOzsKCQktcCB8IC0tcGFja2FnZXMpIFBBQ0tBR0VTPSIke1BBQ0tBR0VTOi19ICR7Mn0iOzsKCQktciB8IC0tcmVwb3NpdG9yaWVzLWZpbGUpIFJFUE9TX0ZJTEU9IiR7Mn0iOzsKCQktYyB8IC0tc2NyaXB0LWNocm9vdCkgU0NSSVBUX0NIUk9PVD0neWVzJzsgbj0xOzsKCQktZCB8IC0tdGVtcC1kaXIpIFRFTVBfRElSPSIkezJ9Ijs7CgkJLWggfCAtLWhlbHApIGhlbHAgMDs7CgkJLVYgfCAtLXZlcnNpb24pIGVjaG8gIiR7UFJPR05BTUV9ICR7VkVSU0lPTn0iOyBleGl0IDA7OwoJCS0tKSBzaGlmdDsgYnJlYWs7OwoJZXNhYwoJc2hpZnQgIiR7bn0iCmRvbmUKClsgJHsjfSAtbmUgMCBdIHx8IGhlbHAgMSA+JjIKClJPT1RGU19ERVNUPSIkezF9Ijsgc2hpZnQKU0NSSVBUPQpbICR7I30gLWVxIDAgXSB8fCB7IFNDUklQVD0iJHsxfSI7IHNoaWZ0OyB9CgpbICIkKGlkIC11KSIgLWVxIDAgXSB8fCBkaWUgJ1RoaXMgc2NyaXB0IG11c3QgYmUgcnVuIGFzIHJvb3QhJwpbICEgLWUgIiR7VEVNUF9ESVI6LX0iIF0gfHwgZGllICJUZW1wIHBhdGggJHtURU1QX0RJUn0gbXVzdCBub3QgZXhpc3QhIgoKQUxQSU5FX0JSQU5DSD0iJHtBTFBJTkVfQlJBTkNIOj0ibGF0ZXN0LXN0YWJsZSJ9IgpBTFBJTkVfTUlSUk9SPSIke0FMUElORV9NSVJST1I6PSJodHRwczovL2RsLWNkbi5hbHBpbmVsaW51eC5vcmcvYWxwaW5lIn0iCkNMRUFOVVA9IiR7Q0xFQU5VUDo9InllcyJ9IgpERUZBVUxUX1BLR1M9IiR7REVGQVVMVF9QS0dTOj0ieWVzIn0iCktFWVNfRElSPSIke0tFWVNfRElSOi0vZXRjL2Fway9rZXlzfSIKUEFDS0FHRVM9IiR7UEFDS0FHRVM6LX0iClJFUE9TX0ZJTEU9IiR7UkVQT1NfRklMRTotfSIKU0NSSVBUX0NIUk9PVD0iJHtTQ1JJUFRfQ0hST09UOj0ibm8ifSIKVEVNUF9ESVI9IiR7VEVNUF9ESVI6LSQobWt0ZW1wIC1kIC90bXAvIiR7UFJPR05BTUV9Ii5YWFhYWFgpfSIKCmNhc2UgIiR7QUxQSU5FX0JSQU5DSH0iIGluCglbMC05XSopIEFMUElORV9CUkFOQ0g9InYke0FMUElORV9CUkFOQ0h9Ijs7CmVzYWMKClsgLW4gIiR7UEFDS0FHRVN9IiBdIHx8IFsgIiR7REVGQVVMVF9QS0dTfSIgPSAneWVzJyBdIHx8IFwKCWRpZSAnTm8gcGFja2FnZXMgc3BlY2lmaWVkIHRvIGJlIGluc3RhbGxlZCEnCgpyb290ZnM9IiR7Uk9PVEZTX0RFU1R9IgpzY3JpcHRfZmlsZT0iJHtTQ1JJUFR9IgppZiBbICIke1NDUklQVH0iID0gJy0nIF07IHRoZW4KCXNjcmlwdF9maWxlPSIke1RFTVBfRElSfS8uc2V0dXAuc2giCgl3cml0ZV9zY3JpcHQgIiR7c2NyaXB0X2ZpbGV9IgpmaQppZiBbIC1uICIke3NjcmlwdF9maWxlfSIgXTsgdGhlbgoJc2NyaXB0X2ZpbGU9JChyZWFscGF0aCAiJHtzY3JpcHRfZmlsZX0iKQpmaQoKWyAiJHtDTEVBTlVQfSIgPSBubyBdIHx8IHRyYXAgY2xlYW51cCBFWElUIEhVUCBJTlQgVEVSTQoKIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmlmICEgY29tbWFuZCAtdiAiJHtBUEt9IiA+L2Rldi9udWxsOyB0aGVuCgllaW5mbyAiJHtBUEt9IG5vdCBmb3VuZCwgZG93bmxvYWRpbmcgc3RhdGljIGFway10b29scyIKCgl3Z2V0cyAiJHtBUEtfVE9PTFNfVVJJfSIgIiR7QVBLX1RPT0xTX1NIQTI1Nn0iICIke1RFTVBfRElSfSIKCUFQSz0iJHtURU1QX0RJUn0vYXBrLnN0YXRpYyIKCWNobW9kICt4ICIke0FQS30iCmZpCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZWluZm8gJ0luc3RhbGxpbmcgc3lzdGVtJwoKbWtkaXIgLXAgIiR7cm9vdGZzfSIvZXRjL2Fway9rZXlzCgppZiBbIC1mICIke1JFUE9TX0ZJTEV9IiBdOyB0aGVuCglpbnN0YWxsIC1tIDY0NCAiJHtSRVBPU19GSUxFfSIgIiR7cm9vdGZzfSIvZXRjL2Fway9yZXBvc2l0b3JpZXMKZWxzZQoJY2F0ID4gIiR7cm9vdGZzfSIvZXRjL2Fway9yZXBvc2l0b3JpZXMgPDwtRU9GCgkJJHtBTFBJTkVfTUlSUk9SfS8ke0FMUElORV9CUkFOQ0h9L21haW4KCQkke0FMUElORV9NSVJST1J9LyR7QUxQSU5FX0JSQU5DSH0vY29tbXVuaXR5CglFT0YKZmkKCmlmIFsgLWQgIiR7S0VZU19ESVJ9IiBdOyB0aGVuCgljcCAiJHtLRVlTX0RJUn0iLyogIiR7cm9vdGZzfSIvZXRjL2Fway9rZXlzLwplbHNlCglkdW1wX2FscGluZV9rZXlzICIke3Jvb3Rmc30iL2V0Yy9hcGsva2V5cy8KZmkKCmlmIFsgIiR7REVGQVVMVF9QS0dTfSIgPSAneWVzJyBdOyB0aGVuCglfYXBrIGFkZCAtLXJvb3QgIiR7cm9vdGZzfSIgLS1pbml0ZGIgJHtBTFBJTkVfQkFTRV9QS0dTfSA+JjIKZmkKX2FwayBhZGQgLS1yb290ICIke3Jvb3Rmc30iIC0taW5pdGRiICR7UEFDS0FHRVN9ID4mMgoKaWYgISBbIC1mICIke3Jvb3Rmc30iL2V0Yy9hbHBpbmUtcmVsZWFzZSBdOyB0aGVuCglpZiBfYXBrIGluZm8gLS1yb290ICIke3Jvb3Rmc30iIC0tcXVpZXQgYWxwaW5lLXJlbGVhc2UgPi9kZXYvbnVsbDsgdGhlbgoJCV9hcGsgYWRkIC0tcm9vdCAiJHtyb290ZnN9IiBhbHBpbmUtcmVsZWFzZQoJZWxzZQoJCSMgSW4gQWxwaW5lIDwzLjE3LCB0aGlzIHBhY2thZ2UgY29udGFpbnMgL2V0Yy9vcy1yZWxlYXNlLAoJCSMgL2V0Yy9hbHBpbmUtcmVsZWFzZSBhbmQgL2V0Yy9pc3N1ZSwgYnV0IHdlIGRvbid0IHdhbm5hIGluc3RhbGwgYWxsCgkJIyBpdHMgZGVwZW5kZW5jaWVzIChlLmcuIG9wZW5yYykuCgkJX2FwayBmZXRjaCAtLXJvb3QgIiR7cm9vdGZzfSIgLS1zdGRvdXQgYWxwaW5lLWJhc2UgXAoJCQl8IHRhciAteHogLUMgIiR7cm9vdGZzfSIgZXRjID4mMgoJZmkKZmkKCiMgRGlzYWJsZSByb290IGxvZyBpbiB3aXRob3V0IHBhc3N3b3JkLgpzZWQgLWkgJ3MvXnJvb3Q6Oi9yb290Oio6LycgIiR7cm9vdGZzfSIvZXRjL3NoYWRvdwoKWyAtZSAiJHtyb290ZnN9Ii92YXIvcnVuIF0gfHwgbG4gLXMgL3J1biAiJHtyb290ZnN9Ii92YXIvcnVuCgojLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KaWYgWyAtbiAiJHtTQ1JJUFR9IiBdOyB0aGVuCglzY3JpcHRfbmFtZT0iJHtzY3JpcHRfZmlsZSMjKi99IgoKCWlmIFsgIiR7U0NSSVBUX0NIUk9PVH0iID0gJ25vJyBdOyB0aGVuCgkJZWluZm8gIkV4ZWN1dGluZyBzY3JpcHQ6ICR7c2NyaXB0X25hbWV9ICQqIgoKCQlST09URlM9IiR7cm9vdGZzfSIgIiR7c2NyaXB0X2ZpbGV9IiAiJEAiID4mMiB8fCBkaWUgJ1NjcmlwdCBmYWlsZWQnCgllbHNlCgkJZWluZm8gJ1ByZXBhcmluZyBjaHJvb3QnCgoJCV9hcGsgYWRkIC0tcm9vdCAiJHtyb290ZnN9IiAtdCAiJHtWSVJUVUFMX1BLR30iIGFway10b29scyA+JjIKCQlwcmVwYXJlX2Nocm9vdCAiJHtyb290ZnN9IgoKCQlpZiBbICIke1NDUklQVH0iID0gJy0nIF07IHRoZW4KCQkJY3AgIiR7c2NyaXB0X2ZpbGV9IiAiJHtyb290ZnN9LyR7c2NyaXB0X25hbWV9IgoJCQliaW5kX2Rpcj0iJChwd2QpIgoJCQlzY3JpcHRfZmlsZTI9Ii8ke3NjcmlwdF9uYW1lfSIKCQllbHNlCgkJCWJpbmRfZGlyPSIkKGRpcm5hbWUgIiR7c2NyaXB0X2ZpbGV9IikiCgkJCXNjcmlwdF9maWxlMj0iLi8ke3NjcmlwdF9uYW1lfSIKCQlmaQoJCWVjaG8gIk1vdW50aW5nICR7YmluZF9kaXJ9IHRvIC9tbnQgaW5zaWRlIGNocm9vdCIgPiYyCgkJbW91bnRfYmluZCAiJHtiaW5kX2Rpcn0iICIke3Jvb3Rmc30iL21udAoKCQllaW5mbyAiRXhlY3V0aW5nIHNjcmlwdCBpbiBjaHJvb3Q6ICR7c2NyaXB0X25hbWV9ICQqIgoKCQljaHJvb3QgIiR7cm9vdGZzfSIgXAoJCQkvYmluL3NoIC1jICJjZCAvbW50ICYmICR7c2NyaXB0X2ZpbGUyfSBcIlwkQFwiIiAtLSAiJEAiID4mMiBcCgkJCXx8IGRpZSAnU2NyaXB0IGZhaWxlZCcKCgkJWyAiJHtTQ1JJUFR9IiA9ICctJyBdICYmIHJtIC1mICIke3Jvb3Rmc30vJHtzY3JpcHRfbmFtZX0iCgkJdW1vdW50X3JlY3Vyc2l2ZWx5ICIke3Jvb3Rmc30iCglmaQpmaQoKIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmVpbmZvICdDbGVhbmluZy11cCByb290ZnMnCgppZiBfYXBrIGluZm8gLS1yb290ICIke3Jvb3Rmc30iIC0tcXVpZXQgLS1pbnN0YWxsZWQgIiR7VklSVFVBTF9QS0d9IjsgdGhlbgoJX2FwayBkZWwgLS1yb290ICIke3Jvb3Rmc30iIC0tcHVyZ2UgIiR7VklSVFVBTF9QS0d9IiA+JjIKZmkKCmlmIGdyZXAgLXF3ICIke1JFU09MVkNPTkZfTUFSS30iICIke3Jvb3Rmc30iL2V0Yy9yZXNvbHYuY29uZiAyPi9kZXYvbnVsbDsgdGhlbgoJcm0gIiR7cm9vdGZzfSIvZXRjL3Jlc29sdi5jb25mCmZpCgpybSAtUmYgIiR7cm9vdGZzOj99Ii9kZXYvKgoKaWYgWyAtZiAiJHtyb290ZnN9Ii9zYmluL2FwayBdOyB0aGVuCglybSAtUmYgIiR7cm9vdGZzfSIvdmFyL2NhY2hlL2Fway8qCmVsc2UKCXJtIC1SZiAiJHtyb290ZnN9Ii9ldGMvYXBrICIke3Jvb3Rmc30iL2xpYi9hcGsgIiR7cm9vdGZzfSIvdmFyL2NhY2hlL2FwawpmaQo=' | base64 -d | /bin/sh -s -- "${TO}" || die "Failed to create Alpine Linux rootfs!"

# Execute the second stage script to pivot into the new rootfs.
exec /bin/sh -c "$(printf '%s' 'IyEvYmluL3NoCiMgdmltOiBzZXQgdHM9NCBzdz00OgojLS0taGVscC0tLQojIFVzYWdlOiBzdGFnZTIuc2gKIwojIEVudmlyb25tZW50IFZhcmlhYmxlczoKIyAgIFRPOiBUaGUgcGF0aCB0byB0aGUgdGFyZ2V0IGRpcmVjdG9yeS4gUmVxdWlyZWQuCiMgICBTU0hfUE9SVDogVGhlIHBvcnQgbnVtYmVyIGZvciB0aGUgc2Vjb25kYXJ5IFNTSCBzZXJ2ZXIuIFJlcXVpcmVkLgojICAgU1NIX1BBU1NXT1JEOiBUaGUgbmV3IHBhc3N3b3JkIGZvciB0aGUgcm9vdCBhY2NvdW50LiBSZXF1aXJlZC4KIy0tLWhlbHAtLS0Kc2V0IC1ldQoKIyBEZWZpbmUgYSBmdW5jdGlvbiB0byBwcmludCBhbiBlcnJvciBtZXNzYWdlIGFuZCBleGl0CmRpZSgpIHsKCXByaW50ZiAnXDAzM1sxOzMxbUVSUk9SOlwwMzNbMG0gJXNcbicgIiR7QH0iID4mMiAgIyBib2xkIHJlZAoJZXhpdCAxCn0KCiMgRW5zdXJlIHRoYXQgdGhpcyBzY3JpcHQgaXMgcnVuIGZyb20gdGFrZW92ZXIuc2gKWyAiJHtfX1JVTl9GUk9NX1RBS0VPVkVSX1NIOi19IiA9ICIxIiBdIHx8IFwKCWRpZSAiVGhpcyBzY3JpcHQgbXVzdCBub3QgYmUgZXhlY3V0ZWQgZGlyZWN0bHkhIFVzZSB0YWtlb3Zlci5zaC4iCgojIFBhcnNlIGFyZ3VtZW50cwpUTz0ke1RPOj99ClNTSF9QT1JUPSR7U1NIX1BPUlQ6P30KU1NIX1BBU1NXT1JEPSR7U1NIX1BBU1NXT1JEOj99CgojIENoYW5nZSB0byB0aGUgdGFyZ2V0IGRpcmVjdG9yeQpjZCAiJHtUT30iCgojIFNldHVwIGhlbHBlciB2YXJpYWJsZXMgYW5kIGZ1bmN0aW9ucwpCVVNZQk9YPSIuL2Jpbi9idXN5Ym94LnN0YXRpYyIKJHtCVVNZQk9YfSBjYXQgPiBidXN5Ym94LmVpbmZvIDw8RU9GCiR7QlVTWUJPWH0gcHJpbnRmICdcblwwMzNbMTszNm0+ICVzXDAzM1swbVxuJyAiXCR7Kn0iID4mMiAgIyBib2xkIGN5YW4KRU9GCiR7QlVTWUJPWH0gY2F0ID4gYnVzeWJveC5kaWVfbXNnIDw8RU9GCiR7QlVTWUJPWH0gcHJpbnRmICdcMDMzWzE7MzFtRVJST1I6XDAzM1swbSAlc1xuJyAiXCR7Kn0iID4mMiAgIyBib2xkIHJlZApFT0YKRElFX01TRz0iJHtCVVNZQk9YfSBzaCAuL2J1c3lib3guZGllX21zZyIKRUlORk89IiR7QlVTWUJPWH0gc2ggLi9idXN5Ym94LmVpbmZvIgpDTEVBTlVQX1BBVEhTPSJidXN5Ym94LmVpbmZvIGJ1c3lib3guZGllX21zZyIKJHtCVVNZQk9YfSBjaG1vZCAreCBidXN5Ym94LmVpbmZvIGJ1c3lib3guZGllX21zZwoKIyBHZXQgdGhlIHBhdGggdG8gdGhlIGN1cnJlbnQgaW5pdApPTERfSU5JVD0kKCR7QlVTWUJPWH0gcmVhZGxpbmsgL3Byb2MvMS9leGUpCgojIENoYW5nZSB0aGUgcm9vdCBwYXNzd29yZCBmb3IgdGhlIGNocm9vdCBlbnZpcm9ubWVudAoke0JVU1lCT1h9IGNocm9vdCAuIC91c3IvYmluL3Bhc3N3ZCByb290ID4gL2Rldi9udWxsIDI+JjEgPDxFT0YKJHtTU0hfUEFTU1dPUkR9CiR7U1NIX1BBU1NXT1JEfQpFT0YKCiMgU2V0IHVwIHRoZSB0YXJnZXQgZmlsZXN5c3RlbQoke0VJTkZPfSAiU2V0dGluZyB1cCB0YXJnZXQgZmlsZXN5c3RlbS4uLiIKJHtCVVNZQk9YfSBybSAtZiBldGMvbXRhYgoke0JVU1lCT1h9IGxuIC1zIC9wcm9jL21vdW50cyBldGMvbXRhYgoke0JVU1lCT1h9IGluc3RhbGwgLUQgLW0gNjQ0IC9ldGMvcmVzb2x2LmNvbmYgZXRjL3Jlc29sdi5jb25mCiR7QlVTWUJPWH0gbWtkaXIgLXAgb2xkX3Jvb3QKCiMgTW91bnQgcHNldWRvLWZpbGVzeXN0ZW1zCiR7RUlORk99ICJNb3VudGluZyBwc2V1ZG8tZmlsZXN5c3RlbXMuLi4iCiR7QlVTWUJPWH0gbW91bnQgLXQgdG1wZnMgdG1wIHRtcAoke0JVU1lCT1h9IG1vdW50IC10IHByb2MgcHJvYyBwcm9jCiR7QlVTWUJPWH0gbW91bnQgLXQgc3lzZnMgc3lzIHN5cwppZiAhICR7QlVTWUJPWH0gbW91bnQgLXQgZGV2dG1wZnMgZGV2IGRldjsgdGhlbgoJJHtCVVNZQk9YfSBtb3VudCAtdCB0bXBmcyBkZXYgZGV2Cgkke0JVU1lCT1h9IGNwIC1hIC9kZXYvKiBkZXYvCgkke0JVU1lCT1h9IHJtIC1yZiBkZXYvcHRzCgkke0JVU1lCT1h9IG1rZGlyIGRldi9wdHMKZmkKJHtCVVNZQk9YfSBtb3VudCAtLWJpbmQgL2Rldi9wdHMgZGV2L3B0cwoKIyBHZXQgdGhlIGN1cnJlbnQgVFRZClRUWT0iJCgke0JVU1lCT1h9IHR0eSkiCgojIFJlZGlyZWN0IHN0ZGluLCBzdGRvdXQsIGFuZCBzdGRlcnIgdG8gdGhlIFRUWQoke0VJTkZPfSAiQ2hlY2tpbmcgYW5kIHN3aXRjaGluZyBUVFkuLi4iCmV4ZWMgPCIke1RPfS8ke1RUWX0iID4iJHtUT30vJHtUVFl9IiAyPiIke1RPfS8ke1RUWX0iCgojIFByaW50IGEgbWVzc2FnZSBhbmQgd2FpdCBmb3IgdXNlciBjb25maXJtYXRpb24KJHtFSU5GT30gIlR5cGUgJ09LJyB0byBjb250aW51ZSIKJHtCVVNZQk9YfSBwcmludGYgIj4gIgpyZWFkIC1yIGEKaWYgWyAiJHthfSIgIT0gIk9LIiBdOyB0aGVuCglleGl0IDEKZmkKCiMgUHJlcGFyZSB0aGUgbmV3IGluaXQgc2NyaXB0CiR7RUlORk99ICJQcmVwYXJpbmcgaW5pdC4uLiIKJHtCVVNZQk9YfSBjYXQgPiJ0bXAvJHtPTERfSU5JVCMjKi99IiA8PEVPRgojISR7VE99LyR7QlVTWUJPWH0gc2gKCmV4ZWMgPCIke1RPfS8ke1RUWX0iID4iJHtUT30vJHtUVFl9IiAyPiIke1RPfS8ke1RUWX0iCgpjZCAiJHtUT30iCgoke0VJTkZPfSAnUGl2b3Rpbmcgcm9vdCBhbmQgcmVtb3Zpbmcgb2xkIHRha2VvdmVyIGRpcmVjdG9yeS4uLicKJHtCVVNZQk9YfSBtb3VudCAtLW1ha2UtcnByaXZhdGUgLwoke0JVU1lCT1h9IHBpdm90X3Jvb3QgLiBvbGRfcm9vdCAmJiAke0JVU1lCT1h9IHJtZGlyIC9vbGRfcm9vdCR7VE99CiR7RUlORk99ICdDbG9zaW5nIGFsbCBmaWxlIGRlc2NyaXB0b3JzIGV4Y2VwdCBzdGRpbiwgc3Rkb3V0LCBzdGRlcnIuLi4nCmZvciBmZCBpbiAvcHJvYy9zZWxmL2ZkLyo7IGRvCglmZD1cJHtmZCMjKi99CgljYXNlICJcJHtmZH0iIGluCgkJWzAxMl0pIGNvbnRpbnVlIDs7Cgllc2FjCglldmFsICJleGVjIFwke2ZkfT4mLSIKZG9uZQoke0VJTkZPfSAnQ2xlYW5pbmcgdXAgYW5kIHJ1bm5pbmcgbmV3IGluaXQuLi4nCmZvciBwYXRoIGluICR7Q0xFQU5VUF9QQVRIU307IGRvCgkke0JVU1lCT1h9IHJtIC1mICJcJHtwYXRofSIKZG9uZQpleGVjICR7QlVTWUJPWH0gc2ggLWMgIiR7QlVTWUJPWH0gcm0gLWYgJy90bXAvJHtPTERfSU5JVCMjKi99JyAmJiBleGVjIC9zYmluL2luaXQiCkVPRgoke0JVU1lCT1h9IGNobW9kICt4ICJ0bXAvJHtPTERfSU5JVCMjKi99IgoKIyBHZW5lcmF0ZSBuZXcgU1NIIGhvc3Qga2V5cwoke0VJTkZPfSAiR2VuZXJhdGluZyBuZXcgU1NIIGhvc3Qga2V5cy4uLiIKJHtCVVNZQk9YfSBjaHJvb3QgLiAvdXNyL2Jpbi9kcm9wYmVhcmtleSAtdCByc2EgLWYgL2V0Yy9kcm9wYmVhci9kcm9wYmVhcl9yc2FfaG9zdF9rZXkKJHtCVVNZQk9YfSBjaHJvb3QgLiAvdXNyL2Jpbi9kcm9wYmVhcmtleSAtdCBlY2RzYSAtZiAvZXRjL2Ryb3BiZWFyL2Ryb3BiZWFyX2VjZHNhX2hvc3Rfa2V5CiR7QlVTWUJPWH0gY2hyb290IC4gL3Vzci9iaW4vZHJvcGJlYXJrZXkgLXQgZWQyNTUxOSAtZiAvZXRjL2Ryb3BiZWFyL2Ryb3BiZWFyX2VkMjU1MTlfaG9zdF9rZXkKCiMgU3RhcnQgdGhlIHNlY29uZGFyeSBTU0ggc2VydmVyCiR7RUlORk99ICJTdGFydGluZyBzZWNvbmRhcnkgU1NIIHNlcnZlciBvbiBwb3J0ICR7U1NIX1BPUlR9Li4uIgoke0JVU1lCT1h9IGNocm9vdCAuIC91c3Ivc2Jpbi9kcm9wYmVhciAtcCAiJHtTU0hfUE9SVH0iCgojIFByaW50IHRoZSBjcmVkZW50aWFscyBmb3IgdGhlIHNlY29uZGFyeSBTU0ggc2VydmVyIGFuZCB3YWl0IGZvciB1c2VyIGNvbmZpcm1hdGlvbgoke0VJTkZPfSAiWW91IHNob3VsZCBTU0ggaW50byB0aGUgc2Vjb25kYXJ5IHNzaGQgd2l0aCB0aGUgZm9sbG93aW5nIGNyZWRlbnRpYWxzOgogICAtIFBvcnQ6ICR7U1NIX1BPUlR9CiAgIC0gVXNlcm5hbWU6IHJvb3QKICAgLSBQYXNzd29yZDogJHtTU0hfUEFTU1dPUkR9CiAgIC0gQ29tbWFuZDogc3NoIC1wICR7U1NIX1BPUlR9IC1vIFVzZXJLbm93bkhvc3RzRmlsZT0vZGV2L251bGwgLW8gU3RyaWN0SG9zdEtleUNoZWNraW5nPW5vIHJvb3RAPElQPiIKJHtFSU5GT30gIlR5cGUgJ09LJyB0byBjb250aW51ZSIKJHtCVVNZQk9YfSBwcmludGYgIj4gIgpyZWFkIC1yIGEKaWYgWyAiJHthfSIgIT0gIk9LIiBdOyB0aGVuCglleGl0IDEKZmkKCiMgUHJpbnQgYSBtZXNzYWdlIHRvIGluZm9ybSB0aGF0IHRoZSB0YWtlb3ZlciBpcyBhYm91dCB0byBoYXBwZW4KIyBhbmQgdGhlIG5leHQgc3RlcHMgdG8gdGFrZSBhZnRlciB0aGUgdGFrZW92ZXIgaXMgc3VjY2Vzc2Z1bAoke0VJTkZPfSBcCiJBYm91dCB0byB0YWtlIG92ZXIgaW5pdC4gVGhpcyBzY3JpcHQgd2lsbCBub3cgcGF1c2UgZm9yIGEgZmV3IHNlY29uZHMuCj4gSWYgdGhlIHRha2VvdmVyIHdhcyBzdWNjZXNzZnVsLCB5b3Ugd2lsbCBzZWUgb3V0cHV0IGZyb20gdGhlIG5ldyBpbml0Lgo+IFlvdSBtYXkgdGhlbiBraWxsIHRoZSByZW1uYW50cyBvZiB0aGlzIHNlc3Npb24gYW5kIGFueSByZW1haW5pbmcKPiBwcm9jZXNzZXMgZnJvbSB5b3VyIG5ldyBTU0ggc2Vzc2lvbiwgYW5kIHVtb3VudCB0aGUgb2xkIHJvb3QgZmlsZXN5c3RlbS4iCgojIEJpbmQgbW91bnQgb2xkIGluaXQgYmluYXJ5IHRvIHRoZSBuZXcgaW5pdAoke0JVU1lCT1h9IG1vdW50IC0tYmluZCAidG1wLyR7T0xEX0lOSVQjIyovfSIgIiR7T0xEX0lOSVR9IgoKIyBSZS1leGVjIGluaXQgdG8gc3RhcnQgdGhlIG5ldyBpbml0LgojCiMgTk9URTogRE8gTk9UIHVzZSAke0VJTkZPfSwgJHtESUVfTVNHfSwgb3IgYW55IG90aGVyIHZhcmlhYmxlcyBvcgojICAgICAgIGZ1bmN0aW9ucyBkZWZpbmVkIGFib3ZlIGFmdGVyIHRoaXMgcG9pbnQgYXMgdGhleSB3aWxsIG5vdAojICAgICAgIHdpbGwgbm8gbG9uZ2VyIGJlIGF2YWlsYWJsZSBiZXlvbmQgdGhpcyBwb2ludCBhcyBpdCB3aWxsCiMgICAgICAgYmUgcmVtb3ZlZCBieSB0aGUgbmV3IGluaXQuCmlmIGNvbW1hbmQgLXYgc3lzdGVtY3RsID4gL2Rldi9udWxsIDI+JjE7IHRoZW4KCXN5c3RlbWN0bCBkYWVtb24tcmVleGVjCmVsaWYgY29tbWFuZCAtdiB0ZWxpbml0ID4gL2Rldi9udWxsIDI+JjE7IHRoZW4KCXRlbGluaXQgdQplbHNlCgkke0RJRV9NU0d9ICJEb24ndCBrbm93IGhvdyB0byByZS1leGVjIGluaXQiCglleGl0IDEKZmkKCiMgVW5zZXQgdHJhcCBoYW5kbGVyIGFzIGNsZWFudXAgaXMgbm8gbG9uZ2VyIHJlcXVpcmVkCiMgYXMgdGhlIHRha2VvdmVyIHdhcyBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5LiBUaGlzIGlzCiMgdGVjaG5pY2FsbHkgbm90IHJlcXVpcmVkIGFzIHdlIGNhbGwgZXhlYyBiZWxvdywgYnV0CiMgaXQncyBiZXR0ZXIgaW4gY2FzZSBzb21ldGhpbmcgY2hhbmdlcyBpbiB0aGUgZnV0dXJlLgp0cmFwICcnIEVYSVQgSFVQIElOVCBURVJNCgojIFNsZWVwIGZvciBhIHdoaWxlIHRvIGFsbG93IHRoZSBuZXcgaW5pdCB0byBzdGFydApleGVjICR7QlVTWUJPWH0gc2xlZXAgMTAK' | base64 -d)"
